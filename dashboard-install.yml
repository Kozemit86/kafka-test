---
-
  become: true
  hosts: kube-master-01
  become_method: sudo
  become_user: root
  tasks:
  - name: Update APT
    apt:
      update_cache: yes

  - name: Install packeges
    apt:
      name:
        - curl
        - wget
        - mlocate

  - name: Create a /opt/download
    ansible.builtin.file:
      path: /opt/download
      state: directory
      mode: '0777'

  - name: Download kubernetes-dashboard.yaml
    get_url:
      url: https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended.yaml
      dest: /opt/download
      mode: '0444'

  - name: Create dashboard
    shell: kubectl create -f /opt/download/recommended.yaml

  - name: Create serviceaccount
    shell: kubectl create serviceaccount dashboard-admin-sa

  - name: Create clusterrolebinding
    shell: kubectl create clusterrolebinding dashboard-admin-sa --clusterrole=cluster-admin --serviceaccount=default:dashboard-admin-sa
