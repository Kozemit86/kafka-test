---
-
  become: true
  hosts: masters
  become_method: sudo
  become_user: root
  tasks:
  - name: Edit etcd config
    copy:
      dest: "/etc/default/etcd"
      content: |
        ETCD_NAME="{{inventory_hostname}}"
        ETCD_DATA_DIR="/var/lib/etcd/default.etcd"
        ETCD_LISTEN_PEER_URLS="http://{{ansible_host}}:2380"
        ETCD_LISTEN_CLIENT_URLS="http://{{ansible_host}}:2379,http://127.0.0.1:2379"
        ETCD_INITIAL_ADVERTISE_PEER_URLS="http://{{ansible_host}}:2380"
        ETCD_INITIAL_CLUSTER_STATE="new"
        ETCD_INITIAL_CLUSTER_TOKEN="etcd-token-1"
        ETCD_ADVERTISE_CLIENT_URLS="http://{{ansible_host}}:2379"
        ETCD_INITIAL_CLUSTER="{{ hostvars['master01'].inventory_hostname }}=http://{{ hostvars['master01'].ansible_host }}:2380,{{ hostvars['master02'].inventory_hostname }}=http://{{ hostvars['master02'].ansible_host }}:2380,{{ hostvars['master03'].inventory_hostname }}=http://{{ hostvars['master03'].ansible_host }}:2380"
